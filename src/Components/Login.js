import React, {Component} from 'react';
import {Link} from 'react-router-dom';

class Login extends Component {
  constructor(props) {
    super(props);
    this.state = {
      submitted: false,
    }
  }

  login = event => {
    event.preventDefault();
    this.setState({
      submitted: true
    });
    let email = event.target.email.value;
    let password = event.target.password.value;
    event.target.reset();
    this.props.get('/login', [{name: 'email', value: email}, {name: 'password', value: password}])
        .then((result) => {
          console.log('logged in');
          console.log(result);
          let user = result.result;
          localStorage.setItem('uid', user.id);
          window.location.reload();
        })
        .catch(err => {
          this.setState({
            submitted: false
          });
          alert(err);
        });
  };

  render() {
    let inputStyle = {
      width: '100%',
      padding: '12px 20px',
      margin: '8px 0',
      display: 'inline-block',
      border: '1px solid #ccc',
      boxSizing: 'border-box',
    };

    let loginButton = {
      backgroundColor: '#4CAF50',
      color: 'white',
      margin: '8px 0',
      padding: '15px',
      border: 'none',
      cursor: 'pointer',
      width: '100%',
    };

    let formStyle = {
      width: '50%',
      margin: 'auto'
    };

    let cancelButton = {
      width: 'auto',
      padding: '10px 18px',
      backgroundColor: '#f44336'
    };

    let psw = {
      float: 'right',
      paddingTop: '10px',
      paddingRight: '16px'
    };

    return (
      !this.state.submitted ?
        <form onSubmit={this.login} style={formStyle}>
          <h2>Welcome to the Exploit Database</h2>

          <div className="container">
            <label htmlFor="uname"><b>Email</b></label>
            <input type="email" style={inputStyle} placeholder="Enter Email" name="email" required/>
            <label htmlFor="psw"><b>Password</b></label>
            <input type="password" style={inputStyle} placeholder="Enter Password" name="password" required/>
            <button className='login-button' style={loginButton} type="submit">Login</button>
          </div>

          <div className="container" style={{backgroundColor: '#f1f1f1'}}>
            <button style={cancelButton} type="button" className="login-button cancelbtn">Cancel</button>
            <Link style={psw} to={'/createUser'}>Create Account</Link>
          </div>
        </form>
        :
        <div>Loading</div>
    )
  }
}

export default Login;
